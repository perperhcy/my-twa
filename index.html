<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Telegram Mini App</h1>
    <p>Click the button below to forward the message.</p>
    <button id="forwardButton">Forward Message</button>

    <script>
        // 初始化 Web App
        Telegram.WebApp.ready();

        document.getElementById('forwardButton').addEventListener('click', function() {
            // 显示主按钮并设置文本
            Telegram.WebApp.MainButton.text = "Forwarding...";
            Telegram.WebApp.MainButton.show();

            // 获取当前 Web App 上下文
            let tg = Telegram.WebApp;
            let userId = tg.initDataUnsafe.user.id;
            
            // 示例 message_id，需要替换为实际要转发的消息 ID
            let messageId = 12345; 

            // 打开 Telegram 转发功能
            openForwardDialog(userId, messageId);
        });

        function openForwardDialog(userId, messageId) {
            Telegram.WebApp.MainButton.setText("Select chat to forward");
            
            // 在此显示自定义弹窗或界面，引导用户选择目标聊天
            alert("Please select a chat to forward the message.");

            // 这里你需要引导用户在 Telegram 客户端中选择要转发的聊天
            // 完成后，调用 forwardMessage 函数进行转发

            // 示例中，假设用户选择了目标 chat_id
            let targetChatId = prompt("Enter the target chat ID:");

            if (targetChatId) {
                forwardMessage(targetChatId, userId, messageId);
            } else {
                Telegram.WebApp.MainButton.hide();
            }
        }

        function forwardMessage(targetChatId, fromChatId, messageId) {
            let apiUrl = `https://api.telegram.org/bot<YOUR_BOT_API_TOKEN>/forwardMessage`;
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    chat_id: targetChatId,
                    from_chat_id: fromChatId,
                    message_id: messageId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    Telegram.WebApp.MainButton.setText("Message Forwarded");
                } else {
                    Telegram.WebApp.MainButton.setText("Error");
                }
                setTimeout(() => Telegram.WebApp.MainButton.hide(), 3000);
            })
            .catch(error => {
                console.error('Error forwarding message:', error);
                Telegram.WebApp.MainButton.setText("Error");
                setTimeout(() => Telegram.WebApp.MainButton.hide(), 3000);
            });
        }
    </script>
</body>
</html>
