<!-- <!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React + TS</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html> -->

<!DOCTYPE html>
<html>
  <head>
    <title>输入框示例</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>

  <body>
    <p id="text-container">Loading...</p>

    <h1>获取输入框内容示例</h1>
    <input type="text" id="inputField" placeholder="请输入内容" />
    <button onclick="getInputValue()">获取内容</button>

    <h1>Welcome!</h1>
    <p id="beforeunload">Loading data...</p>
    <p id="unload">Loading data...</p>
    <p id="displayData">Loading data...</p>

    <input type="text" id="inputData" placeholder="Enter some data" />
    <button onclick="storeData()">Save Data</button>

    <script>
      const tele = window.Telegram.WebApp;

      // 等待 Telegram Web App 初始化完成
      tele.ready(function () {});
      console.log("initParams  " + Telegram.WebApp.initParams);

      //显示version of the Bot API
      const version = tele.version;
      document.getElementById("text-container").innerText =
        "The version of the Bot API--" + version;

      //设置header颜色
      tele.setHeaderColor("#c31418");

      const initData = tele.initData;
      console.log("initData  " + initData);

      tele.enableClosingConfirmation();
      tele.onEvent("popupClosed", function () {
        storeData();
      });

      // tele.BackButton.isVisible = true;
      // tele.onEvent("backButtonClicked", function () {
      //   tele.close();
      // });

      // tele.MainButton.isVisible = true;
      // tele.onEvent("mainButtonClicked", function () {
      //   alert("mainButtonClicked");
      // });

      // tele.SettingsButton.isVisible = true;
      // tele.onEvent("settingsButtonClicked", function () {
      //   alert("settingsButtonClicked");
      // });

      // 监听 beforeunload 事件
      window.addEventListener("beforeunload", function (event) {
        // 在这里可以执行一些操作，比如记录日志或发送请求
        console.log("用户即将离开页面");

        // 获取当前时间的 Date 对象
        const now = new Date();

        // 获取具体的时间组件
        const year = now.getFullYear();
        const month = (now.getMonth() + 1).toString().padStart(2, "0"); // 月份从0开始，需要加1，并确保两位数
        const day = now.getDate().toString().padStart(2, "0");
        const hours = now.getHours().toString().padStart(2, "0");
        const minutes = now.getMinutes().toString().padStart(2, "0");
        const seconds = now.getSeconds().toString().padStart(2, "0");

        // 格式化时间字符串
        const formattedTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

        localStorage.setItem("beforeunload", formattedTime);
      });

      // 监听 unload 事件
      window.addEventListener("unload", function (event) {
        console.log("用户已离开页面");

        // 获取当前时间的 Date 对象
        const now = new Date();

        // 获取具体的时间组件
        const year = now.getFullYear();
        const month = (now.getMonth() + 1).toString().padStart(2, "0"); // 月份从0开始，需要加1，并确保两位数
        const day = now.getDate().toString().padStart(2, "0");
        const hours = now.getHours().toString().padStart(2, "0");
        const minutes = now.getMinutes().toString().padStart(2, "0");
        const seconds = now.getSeconds().toString().padStart(2, "0");

        // 格式化时间字符串
        const formattedTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

        localStorage.setItem("unload", formattedTime);
      });

      // 这个函数将在点击按钮时被调用
      function getInputValue() {
        // 获取输入框的元素
        var inputElement = document.getElementById("inputField");
        // 获取输入框的内容
        var inputValue = inputElement.value;
        // 显示输入框的内容
        // alert("输入的内容是: " + inputValue);

        const invoiceLink = inputValue;

        // 打开支付窗口
        tele.openInvoice(invoiceLink, function (paymentResult) {
          if (paymentResult.status === "paid") {
            //请求校验订单接口
          } else {
            //alert('支付失败，请重试。');
          }
        });

        /*
invoiceClosed	Bot API 6.1+ Occurrs when the opened invoice is closed.
eventHandler receives an object with the two fields: url – invoice link provided and status – one of the invoice statuses:
- paid – invoice was paid successfully,
- cancelled – user closed this invoice without paying,
- failed – user tried to pay, but the payment was failed,
- pending – the payment is still processing. The bot will receive a service message about a successful payment when the payment is successfully paid.
            */
      }

      // 存储数据到Local Storage
      function storeData() {
        const data = document.getElementById("inputData").value;
        if (data) {
          localStorage.setItem("storedData", data);
          alert("Data saved!");
        } else {
          alert("Please enter some data to save.");
        }
      }

      // 读取数据并显示
      function displayStoredData() {
        const beforeunloadstoredData = localStorage.getItem("beforeunload");
        const beforeunloaddisplayElement =
          document.getElementById("beforeunload");

        const unloadstoredData = localStorage.getItem("unload");
        const unloaddisplayElement = document.getElementById("unload");

        const storedData = localStorage.getItem("storedData");
        const displayElement = document.getElementById("displayData");

        beforeunloaddisplayElement.textContent = `beforeunloadstoredData : ${beforeunloadstoredData}`;
        unloaddisplayElement.textContent = `unloadstoredData : ${unloadstoredData}`;
        displayElement.textContent = `Stored Data: ${storedData}`;
      }

      // 页面加载时显示存储的数据
      document.addEventListener("DOMContentLoaded", displayStoredData);
    </script>
  </body>
</html>

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
</head>
<body>
    <h1>Telegram Mini App</h1>
    <img src="https://th.bing.com/th/id/OIP.jTMqvQYsHNZFFuGGx80SGQHaEK?w=284&h=180&c=7&r=0&o=5&pid=1.7" alt="描述图片内容">

    <div id="user-info"></div>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // Wait until the Telegram Web Apps JavaScript API is ready
        Telegram.WebApp.onEvent('ready', function() {

        });
        const user = Telegram.WebApp.initDataUnsafe.user;
        const userInfoDiv = document.getElementById('user-info');
        console.log('user:' + user);    

        const version = Telegram.WebApp.version;
        alert("	The version of the Bot API" + version);

        Telegram.WebApp.disableVerticalSwipes();

            if (user) {
                const userName = user.first_name + ' ' + user.last_name;
                const userAvatar = user.photo_url ? `<img src="${user.photo_url}" alt="User Avatar">` : 'No avatar available';

                console.log('userAvatar:' + user.photo_url);    

                userInfoDiv.innerHTML = `
                    <p>Name: ${userName}</p>
                    <p>Username: ${user.username}</p>
                    <div>${userAvatar}</div>
                `;
            } else {
                console.log('No user data available');    
                const userAvatar = `<img src="https://th.bing.com/th/id/OIP.jTMqvQYsHNZFFuGGx80SGQHaEK?w=284&h=180&c=7&r=0&o=5&pid=1.7" alt="User Avatar">`;
                userInfoDiv.innerHTML = `
                    <div>${userAvatar}</div>
                `;  
            }
    </script>
</body>
</html>
 -->
